<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Magic Master v106 - Correction Finale</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --mtg-gold: #c5a059; }
        body { font-family: Arial, sans-serif; background: #cfd8dc; margin: 0; padding: 0; color: #000; }
        
        /* UI CONTROLS */
        #ui-gate { background: #111; color: white; padding: 15px; border-bottom: 5px solid var(--mtg-gold); position: sticky; top: 0; z-index: 999; }
        @media print { #ui-gate { display: none !important; } .page { margin: 0; box-shadow: none; } }

        /* PAGES DE BASE */
        .page { width: 210mm; height: 297mm; background: white; margin: 10px auto; position: relative; box-sizing: border-box; page-break-after: always; overflow: hidden; }

        /* --- CORRECTION COUVERTURE --- */
        .cover-container { padding: 40px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
        .gold-border { border: 12px double var(--mtg-gold); width: 85%; padding: 60px 20px; margin-top: 50px; text-align: center; }
        .cover-title { font-size: 52pt; font-weight: bold; margin: 0; letter-spacing: 2px; }
        .cover-officiel { color: var(--mtg-gold); font-size: 18pt; font-weight: bold; margin: 30px 0; letter-spacing: 5px; text-transform: uppercase; }
        .cover-line { border: none; border-top: 2px solid #000; width: 120px; margin: 20px auto; }
        .cover-player { color: var(--mtg-gold); font-size: 24pt; font-weight: bold; margin: 20px 0; }
        .cover-format { font-size: 10pt; margin-top: 30px; text-transform: uppercase; }

        /* --- CORRECTION DECKLIST (IMAGE 3) --- */
        .dl-layout { padding: 15mm 15mm 15mm 25mm; height: 100%; display: flex; flex-direction: column; }
        .dl-sidebar { position: absolute; left: 10mm; top: 120mm; transform: rotate(-90deg); transform-origin: left top; width: 400px; font-weight: bold; font-size: 16pt; text-transform: uppercase; white-space: nowrap; }
        
        .dl-header-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .dl-header-table td { border: 1.5px solid #000; padding: 8px; font-size: 9pt; vertical-align: top; }
        .dl-main-title { font-size: 18pt; font-weight: bold; text-align: center; border: 1.5px solid #000; padding: 15px; margin-bottom: -1.5px; }

        .dl-content { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 40px; margin-top: 20px; flex-grow: 1; }
        .sect-title { font-weight: bold; font-size: 10pt; border-bottom: 1.5px solid #000; margin-bottom: 10px; padding-bottom: 3px; }
        .dl-row { display: flex; border-bottom: 1px solid #ddd; padding: 5px 0; font-size: 9pt; align-items: center; }
        .dl-qty { width: 30px; text-align: center; border-right: 1.5px solid #000; margin-right: 10px; font-weight: bold; }

        .dl-footer-flex { display: flex; justify-content: flex-end; align-items: flex-end; margin-top: 20px; }
        .dl-total-box { display: flex; border: 2px solid #000; }
        .dl-total-label { background: #eee; padding: 10px; font-weight: bold; font-size: 9pt; border-right: 2px solid #000; }
        .dl-total-val { padding: 10px 25px; font-weight: bold; font-size: 14pt; }
        
        .official-use { width: 300px; border: 1px solid #000; height: 80px; display: grid; grid-template-columns: 1fr 1fr; margin-left: 40px; }
        .official-cell { padding: 5px; font-size: 7pt; font-weight: bold; border-right: 1px solid #000; }
    </style>
</head>
<body>

<div id="ui-gate">
    <div style="display:flex; gap:20px; align-items:center;">
        <input type="file" id="csvFile" onchange="loadCSV()">
        <select id="fmtSelect" onchange="render()"><option value="STANDARD">STANDARD</option><option value="CMD">CMD</option></select>
        <input type="text" id="p_name" value="BELEREN, Jace" placeholder="Nom du Joueur" oninput="render()">
        <button onclick="window.print()">GÉNÉRER PDF</button>
    </div>
</div>

<div id="view"></div>

<script>
    let cards = [];

    function loadCSV() {
        const file = document.getElementById('csvFile').files[0];
        Papa.parse(file, {
            header: true, skipEmptyLines: true,
            complete: (r) => {
                cards = r.data.map(row => ({
                    name: row["product-name"] || row["Card Name"] || "Carte",
                    qty: parseInt(row["quantity"]) || 1,
                    type: (row["product-name"] || "").toLowerCase().includes("plains") || (row["product-name"] || "").toLowerCase().includes("island") ? "Land" : "Spell"
                }));
                render();
            }
        });
    }

    function render() {
        const out = document.getElementById('view');
        const pn = document.getElementById('p_name').value;
        const fmt = document.getElementById('fmtSelect').value;
        out.innerHTML = '';

        // --- PAGE 1: COUVERTURE CORRIGÉE ---
        out.innerHTML += `
            <div class="page">
                <div class="cover-container">
                    <div class="gold-border">
                        <h1 class="cover-title">CATALOGUE</h1>
                        <div class="cover-officiel">OFFICIEL</div>
                        <div class="cover-line"></div>
                        <div class="cover-player">${pn}</div>
                        <div class="cover-format">FORMAT: ${fmt}</div>
                    </div>
                </div>
            </div>`;

        // --- PAGE 2: DECKLIST CORRIGÉE (IMAGE 3) ---
        const spells = cards.filter(c => c.type === "Spell");
        const lands = cards.filter(c => c.type === "Land");
        const total = cards.reduce((sum, c) => sum + c.qty, 0);

        out.innerHTML += `
            <div class="page">
                <div class="dl-sidebar">NAME: ${pn}</div>
                <div class="dl-layout">
                    <div class="dl-main-title">MAGIC: THE GATHERING DECKLIST</div>
                    <table class="dl-header-table">
                        <tr>
                            <td style="width:30%">DATE:<br><b>${new Date().toLocaleDateString()}</b></td>
                            <td colspan="2">LOCATION:<br><b>LONGUEUIL, QC</b></td>
                        </tr>
                        <tr>
                            <td>EVENT:<br><b>TOURNAMENT</b></td>
                            <td>DECK NAME:</td>
                            <td style="width:20%">FORMAT:<br><b>${fmt}</b></td>
                        </tr>
                    </table>

                    <div class="dl-content">
                        <div>
                            <div class="sect-title">Main Deck (Spells):</div>
                            ${spells.map(c => `<div class="dl-row"><div class="dl-qty">${c.qty}</div>${c.name}</div>`).join('')}
                        </div>
                        <div>
                            <div class="sect-title">Lands:</div>
                            ${lands.map(c => `<div class="dl-row"><div class="dl-qty">${c.qty}</div>${c.name}</div>`).join('')}
                            
                            <div class="sect-title" style="margin-top:30px;">Sideboard:</div>
                            <div style="height:100px; border-bottom:1px solid #ddd;"></div>
                        </div>
                    </div>

                    <div class="dl-footer-flex">
                        <div class="official-use">
                            <div class="official-cell">FOR OFFICIAL USE ONLY<br><br>Deck Check / Status:</div>
                            <div class="official-cell" style="border:none">Judge Signature:</div>
                        </div>
                        <div class="dl-total-box">
                            <div class="dl-total-label">TOTAL MAIN DECK:</div>
                            <div class="dl-total-val">${total}</div>
                        </div>
                    </div>
                </div>
            </div>`;
    }
</script>
</body>
</html>
